-- olho_gigante.lua

local mon
for _, nome in ipairs(peripheral.getNames()) do
  if peripheral.getType(nome) == "monitor" then
    mon = peripheral.wrap(nome)
    break
  end
end

if not mon then
  print("Nenhum monitor encontrado!")
  return
end

mon.setTextScale(0.5)
local w, h = mon.getSize()
local cx, cy = math.floor(w / 2), math.floor(h / 2)

-- Cores vibrantes
local cores = {
  colors.red, colors.orange, colors.yellow,
  colors.lime, colors.green, colors.blue,
  colors.cyan, colors.purple, colors.pink, colors.magenta
}

-- Posições para onde o olho pode se mover (mais suave e grande)
local posicoes = {
  {x = 0, y = 0}, {x = -3, y = 0}, {x = 3, y = 0},
  {x = 0, y = -2}, {x = 0, y = 2},
  {x = -2, y = -1}, {x = 2, y = -1},
  {x = -2, y = 1}, {x = 2, y = 1}
}

-- Desenha o olho
local function desenharOlho(offsetX, offsetY, cor)
  mon.setBackgroundColor(colors.black)
  mon.clear()

  -- Esclera
  for y = -7, 7 do
    for x = -13, 13 do
      if (x * x) / 169 + (y * y) / 49 <= 1 then
        mon.setCursorPos(cx + x, cy + y)
        mon.setBackgroundColor(colors.white)
        mon.write(" ")
      end
    end
  end

  -- Íris
  for y = -4, 4 do
    for x = -6, 6 do
      if (x * x) / 36 + (y * y) / 16 <= 1 then
        mon.setCursorPos(cx + x + offsetX, cy + y + offsetY)
        mon.setBackgroundColor(cor)
        mon.write(" ")
      end
    end
  end

  -- Pupila
  for y = -1, 1 do
    for x = -1, 1 do
      mon.setCursorPos(cx + x + offsetX, cy + y + offsetY)
      mon.setBackgroundColor(colors.black)
      mon.write(" ")
    end
  end
end

-- Piscar o olho
local function piscar()
  for step = 1, 3 do
    for y = -step, step do
      for x = -13, 13 do
        mon.setCursorPos(cx + x, cy + y)
        mon.setBackgroundColor(colors.black)
        mon.write(" ")
      end
    end
    sleep(0.05)
  end
end

-- Efeito: explosão de cor
local function brilhoExplosivo()
  for i = 1, 20 do
    local x = math.random(1, w)
    local y = math.random(1, h)
    local cor = cores[math.random(#cores)]
    mon.setCursorPos(x, y)
    mon.setBackgroundColor(cor)
    mon.write(" ")
  end
  sleep(0.1)
end

-- Efeito: deslocamento do olho pro canto
local function aparecerNoCanto()
  local cantoX = math.random(0, 1) == 0 and -8 or 8
  local cantoY = math.random(0, 1) == 0 and -4 or 4
  desenharOlho(cantoX, cantoY, cores[math.random(#cores)])
  sleep(0.2)
end

-- Loop principal
while true do
  local pupila = posicoes[math.random(#posicoes)]
  local cor = cores[math.random(#cores)]

  desenharOlho(pupila.x, pupila.y, cor)

  local chance = math.random()
  if chance < 0.1 then
    piscar()
  elseif chance < 0.2 then
    brilhoExplosivo()
  elseif chance < 0.3 then
    aparecerNoCanto()
  end

  sleep(0.4 + math.random())
end
