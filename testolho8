-- OLHO PSICODÉLICO SIMPLIFICADO

local mon = peripheral.find("monitor")
if not mon then
    print("Nenhum monitor encontrado!")
    return
end

-- Configuração do monitor
mon.setTextScale(0.5)
local w, h = mon.getSize()
local centerX, centerY = math.floor(w / 2), math.floor(h / 2)

-- Função para desenhar um pixel
local function drawPixel(x, y, color)
    if x >= 1 and x <= w and y >= 1 and y <= h then
        mon.setBackgroundColor(color)
        mon.setCursorPos(x, y)
        mon.write(" ")
    end
end

-- Função para desenhar um círculo
local function drawCircle(cx, cy, r, color)
    for y = -r, r do
        for x = -r, r do
            if x * x + y * y <= r * r then
                drawPixel(cx + x, cy + y, color)
            end
        end
    end
end

-- Paleta de cores para a íris psicodélica
local rainbow = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.blue, colors.purple, colors.magenta, colors.pink
}

-- Estado da íris
local iris = {
    offsetX = 0,
    offsetY = 0,
    targetX = 0,
    targetY = 0,
    timer = 0
}

-- Atualizar a direção do olhar
local function updateIris()
    iris.timer = iris.timer - 1
    if iris.timer <= 0 then
        iris.targetX = math.random(-3, 3)
        iris.targetY = math.random(-1, 1)
        iris.timer = math.random(20, 60)
    end

    iris.offsetX = iris.offsetX + (iris.targetX - iris.offsetX) * 0.1
    iris.offsetY = iris.offsetY + (iris.targetY - iris.offsetY) * 0.1
end

-- Desenhar o olho completo
local function drawEye()
    mon.setBackgroundColor(colors.black)
    mon.clear()

    -- Esclera (parte branca)
    drawCircle(centerX, centerY, 12, colors.white)

    -- Íris (colorida)
    for i = 6, 1, -1 do
        local color = rainbow[(i + os.clock() * 5) % #rainbow + 1]
        drawCircle(centerX + math.floor(iris.offsetX), centerY + math.floor(iris.offsetY), i + 1, color)
    end

    -- Pupila (preta)
    drawCircle(centerX + math.floor(iris.offsetX), centerY + math.floor(iris.offsetY), 2, colors.black)
end

-- Loop principal
while true do
    updateIris()
    drawEye()
    sleep(0.05)
end
