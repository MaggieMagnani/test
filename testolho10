-- OLHO PSICODÉLICO SIMPLES - VERSÃO FUNCIONAL

-- Detecta o monitor
local mon = peripheral.find("monitor")
if not mon then
    print("Monitor não encontrado.")
    return
end

-- Configuração inicial
mon.setTextScale(0.5)
local w, h = mon.getSize()
local centerX, centerY = math.floor(w / 2), math.floor(h / 2)

-- Cores da íris (arco-íris)
local rainbow = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.blue, colors.purple, colors.magenta, colors.pink
}

-- Função: desenha 1 pixel
local function drawPixel(x, y, color)
    if x >= 1 and x <= w and y >= 1 and y <= h then
        mon.setCursorPos(x, y)
        mon.setBackgroundColor(color)
        mon.write(" ")
    end
end

-- Função: desenha um círculo
local function drawCircle(cx, cy, radius, color)
    for y = -radius, radius do
        for x = -radius, radius do
            if x * x + y * y <= radius * radius then
                drawPixel(cx + x, cy + y, color)
            end
        end
    end
end

-- Estado da íris
local iris = {
    offsetX = 0,
    offsetY = 0,
    targetX = 0,
    targetY = 0,
    timer = 0
}

-- Atualiza a direção da íris
local function updateIris()
    iris.timer = iris.timer - 1
    if iris.timer <= 0 then
        iris.targetX = math.random(-2, 2)
        iris.targetY = math.random(-1, 1)
        iris.timer = math.random(30, 80)
    end

    -- Interpolação suave
    iris.offsetX = iris.offsetX + (iris.targetX - iris.offsetX) * 0.1
    iris.offsetY = iris.offsetY + (iris.targetY - iris.offsetY) * 0.1
end

-- Desenha o olho completo
local function drawEye()
    mon.setBackgroundColor(colors.black)
    mon.clear()

    -- Esclera (branco)
    drawCircle(centerX, centerY, 11, colors.white)

    -- Íris (arco-íris animado)
    for i = 6, 1, -1 do
        local colorIndex = (math.floor(os.clock() * 5 + i) % #rainbow) + 1
        local color = rainbow[colorIndex]
        drawCircle(centerX + math.floor(iris.offsetX), centerY + math.floor(iris.offsetY), i + 1, color)
    end

    -- Pupila (preta)
    drawCircle(centerX + math.floor(iris.offsetX), centerY + math.floor(iris.offsetY), 2, colors.black)
end

-- Loop principal
while true do
    updateIris()
    drawEye()
    sleep(0.05)
end
