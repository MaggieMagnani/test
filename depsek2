--= CONFIGURAÇÃO INICIAL =--
local mon = peripheral.find("monitor")
if not mon then
    print("Nenhum monitor encontrado!")
    return
end

mon.setTextScale(0.5)
local w, h = mon.getSize()
local centerX, centerY = math.floor(w / 2), math.floor(h / 2)

--= CONFIGURAÇÕES DA BALADA =--
local COLORS = {
    colors.purple,
    colors.magenta,
    colors.pink,
    colors.blue,
    colors.cyan,
    colors.red
}

local COLOR_CHANGE_SPEED = 2  -- Mais rápido para balada
local PUPIL_SIZE = 3
local IRIS_SIZE = 10
local EYE_WIDTH = 30
local EYE_HEIGHT = 18

--= ESTADO DO OLHO =--
local eye = {
    colorIndex = 1,
    colorTimer = 0,
    look = {x = 0, y = 0, targetX = 0, targetY = 0},
    moveTimer = 0
}

--= FUNÇÕES DE DESENHO =--
local function drawPixel(x, y, color)
    mon.setBackgroundColor(color)
    mon.setCursorPos(centerX + x, centerY + y)
    mon.write(" ")
end

local function drawEllipse(x, y, rx, ry, color)
    for dy = -ry, ry do
        for dx = -rx, rx do
            if (dx^2)/(rx^2) + (dy^2)/(ry^2) <= 1 then
                drawPixel(x + dx, y + dy, color)
            end
        end
    end
end

--= ATUALIZAÇÃO DE COR =--
local function updateColor(dt)
    eye.colorTimer = eye.colorTimer + dt * COLOR_CHANGE_SPEED
    if eye.colorTimer >= 1 then
        eye.colorTimer = 0
        eye.colorIndex = (eye.colorIndex % #COLORS) + 1
    end
end

--= MOVIMENTO DA ÍRIS =--
local function updateMovement(dt)
    eye.moveTimer = eye.moveTimer + dt
    if eye.moveTimer >= 0.5 then  -- Muda direção mais rápido
        eye.moveTimer = 0
        eye.look.targetX = math.random(-10, 10)
        eye.look.targetY = math.random(-6, 6)
    end
    
    -- Movimento mais rápido e direto
    eye.look.x = eye.look.x + (eye.look.targetX - eye.look.x) * 0.3
    eye.look.y = eye.look.y + (eye.look.targetY - eye.look.y) * 0.3
end

--= DESENHO PRINCIPAL =--
local function drawEye()
    -- Esclera (parte branca do olho)
    drawEllipse(0, 0, EYE_WIDTH, EYE_HEIGHT, colors.white)
    
    -- Cor atual com transição suave
    local currentColor = COLORS[eye.colorIndex]
    local nextColor = COLORS[(eye.colorIndex % #COLORS) + 1]
    local irisColor = colors(currentColor, nextColor, eye.colorTimer)
    
    -- Íris
    drawEllipse(eye.look.x, eye.look.y, IRIS_SIZE, IRIS_SIZE, irisColor)
    
    -- Pupila
    drawEllipse(eye.look.x, eye.look.y, PUPIL_SIZE, PUPIL_SIZE, colors.black)
    
    -- Reflexo (mais visível)
    drawPixel(eye.look.x - 3, eye.look.y - 3, colors.white)
    drawPixel(eye.look.x - 2, eye.look.y - 4, colors.white)
end

--= LOOP PRINCIPAL =--
local lastTime = os.epoch("utc")
while true do
    local currentTime = os.epoch("utc")
    local dt = (currentTime - lastTime) / 1000
    lastTime = currentTime
    
    mon.setBackgroundColor(colors.black)
    mon.clear()
    
    updateColor(dt)
    updateMovement(dt)
    drawEye()
    
    sleep(0.05)  -- ~20 FPS
end--= CONFIGURAÇÃO INICIAL =--
local mon = peripheral.find("monitor")
if not mon then
    print("Nenhum monitor encontrado!")
    return
end

mon.setTextScale(0.5)
local w, h = mon.getSize()
local centerX, centerY = math.floor(w / 2), math.floor(h / 2)

--= CONFIGURAÇÕES DA BALADA =--
local COLORS = {
    colors.purple,
    colors.magenta,
    colors.pink,
    colors.blue,
    colors.cyan,
    colors.red
}

local COLOR_CHANGE_SPEED = 2  -- Mais rápido para balada
local PUPIL_SIZE = 3
local IRIS_SIZE = 10
local EYE_WIDTH = 30
local EYE_HEIGHT = 18

--= ESTADO DO OLHO =--
local eye = {
    colorIndex = 1,
    colorTimer = 0,
    look = {x = 0, y = 0, targetX = 0, targetY = 0},
    moveTimer = 0
}

--= FUNÇÕES DE DESENHO =--
local function drawPixel(x, y, color)
    mon.setBackgroundColor(color)
    mon.setCursorPos(centerX + x, centerY + y)
    mon.write(" ")
end

local function drawEllipse(x, y, rx, ry, color)
    for dy = -ry, ry do
        for dx = -rx, rx do
            if (dx^2)/(rx^2) + (dy^2)/(ry^2) <= 1 then
                drawPixel(x + dx, y + dy, color)
            end
        end
    end
end

--= ATUALIZAÇÃO DE COR =--
local function updateColor(dt)
    eye.colorTimer = eye.colorTimer + dt * COLOR_CHANGE_SPEED
    if eye.colorTimer >= 1 then
        eye.colorTimer = 0
        eye.colorIndex = (eye.colorIndex % #COLORS) + 1
    end
end

--= MOVIMENTO DA ÍRIS =--
local function updateMovement(dt)
    eye.moveTimer = eye.moveTimer + dt
    if eye.moveTimer >= 0.5 then  -- Muda direção mais rápido
        eye.moveTimer = 0
        eye.look.targetX = math.random(-10, 10)
        eye.look.targetY = math.random(-6, 6)
    end
    
    -- Movimento mais rápido e direto
    eye.look.x = eye.look.x + (eye.look.targetX - eye.look.x) * 0.3
    eye.look.y = eye.look.y + (eye.look.targetY - eye.look.y) * 0.3
end

--= DESENHO PRINCIPAL =--
local function drawEye()
    -- Esclera (parte branca do olho)
    drawEllipse(0, 0, EYE_WIDTH, EYE_HEIGHT, colors.white)
    
    -- Cor atual com transição suave
    local currentColor = COLORS[eye.colorIndex]
    local nextColor = COLORS[(eye.colorIndex % #COLORS) + 1]
    local irisColor = colors.blend(currentColor, nextColor, eye.colorTimer)
    
    -- Íris
    drawEllipse(eye.look.x, eye.look.y, IRIS_SIZE, IRIS_SIZE, irisColor)
    
    -- Pupila
    drawEllipse(eye.look.x, eye.look.y, PUPIL_SIZE, PUPIL_SIZE, colors.black)
    
    -- Reflexo (mais visível)
    drawPixel(eye.look.x - 3, eye.look.y - 3, colors.white)
    drawPixel(eye.look.x - 2, eye.look.y - 4, colors.white)
end

--= LOOP PRINCIPAL =--
local lastTime = os.epoch("utc")
while true do
    local currentTime = os.epoch("utc")
    local dt = (currentTime - lastTime) / 1000
    lastTime = currentTime
    
    mon.setBackgroundColor(colors.black)
    mon.clear()
    
    updateColor(dt)
    updateMovement(dt)
    drawEye()
    
    sleep(0.05)  -- ~20 FPS
end
